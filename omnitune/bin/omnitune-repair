#!/usr/bin/env python2

import sys

import labm8 as lab
from labm8 import fs

import omnitune
from omnitune.skelcl import db as _db
from omnitune.skelcl.migrate import migrate


def print_usage_and_exit():
    print("Usage: omnitune-repair <path> [--dry-run]")
    sys.exit(1)


def main(arguments):
    if len(arguments) > 3:
        print_usage_and_exit()

    path = arguments[0]
    dry_run = True if len(arguments) > 1 else False

    if not fs.isfile(path):
        print("File not found!")
        sys.exit(127)

    db = _db.Database(path)
    db.repair(dry_run=dry_run)


if __name__ == "__main__":
    main(sys.argv[1:])
