#!/usr/bin/env python2

import labm8
from labm8 import fs
from labm8 import io

import omnitune
from omnitune import skelcl

import experiment

SAMPLES_TABLE = (
    ("host",           "TEXT"),
    ("device",         "TEXT"),
    ("dev_count",      "INTEGER"),
    ("kernel",         "TEXT"),
    ("data_width",     "INTEGER"),
    ("data_height",    "INTEGER"),
    ("wg_c",           "INTEGER"),
    ("wg_r",           "INTEGER"),
    ("sample_count",   "INTEGER"),
    ("mean_runtime",   "REAL")
    ("median_runtime", "REAL")
)


def create_samples_table(oracle):
    oracle.create_table("samples", SAMPLES_TABLE)
    # TODO: Populate table!


def mkoracle(path):
    fs.rm(path)
    oracle = skelcl.SkelCLDatabase(path)

    for path in experiment.DATABASES:
        if fs.isfile(path):
            io.info("EXPORT  ", path)
            db = skelcl.SkelCLDatabase(path)
            oracle.merge(db)
        else:
            io.info("Skipping", path)

    create_samples_table(oracle)


def main():
    mkoracle(fs.path(experiment.DATABASE_ROOT,
                     experiment.DATABASE_ORACLE))

if __name__ == "__main__":
    main()
