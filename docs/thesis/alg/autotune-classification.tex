\begin{algorithmic}[1]
\Require kernel features $k$, hardware features $h$, dataset features
$d$.
\Ensure workgroup size $w$

\Procedure{Default}{w, a, k, d}
\Comment Use the best safe param.
\State $w \leftarrow \text{classify}(a, k, d)$
\If{$w \in W_{legal}(s)$}
    \State \textbf{return} $w$
\Else
  \State \textbf{return} $\underset{w \in W_{safe}}{\argmax} \text{performance}(\{s|s \in S_{training}\},w)$
\EndIf
\EndProcedure
\item[]

\Procedure{Random}{w, a, k, d}
\Comment Use a random param from $W_{legal}$.
\State $w \leftarrow \text{classify}(a, k, d)$
\If{$w \in W_{legal}(s)$}
    \State \textbf{return} $w$
\Else
  \State \textbf{return} random choice $w \in W_{legal}$
\EndIf
\EndProcedure
\item[]

\Procedure{Reshape}{w, a, k, d}
\Comment Coerce params to be legal.
\State $w \leftarrow \text{classify}(a, k, d)$
\If{$w \in W_{legal}(s)$}
    \State \textbf{return} $w$
\Else
  \State $d_{min} \leftarrow \infty$
  \State $w_{best} \leftarrow \text{null}$
  \For{$c \in W_{legal}$}
    \State $d \leftarrow \sqrt{\left(c_r - w_r\right)^2 + \left(c_c - w_c\right)^2}$
    \If{$d < d_{min}$}
      \State $d_{min} \leftarrow d$
      \State $w_{best} \leftarrow c$
    \EndIF
  \EndFor
  \State \textbf{return} $w \cdot (W_{max}(s) / w)$
\EndIf
\EndProcedure
\end{algorithmic}
